<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>a formulation of truth</title>
    <meta name="description" content="a formulation of truth. Self-inquiry and a Proust Questionnaire.">

    <!-- Open Graph / Twitter -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://aformulationoftruth.com/">
    <meta property="og:title" content="a formulation of truth">
    <meta property="og:description" content="here, a device: the Ätmanoptican as a formulation of truth. Self-inquiry and a Proust Questionnaire.">
    <meta property="og:image" content="https://aformulationoftruth.com/images/dreamMore...always.JPG">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="https://aformulationoftruth.com/">
    <meta name="twitter:title" content="a formulation of truth: a slow experiment">
    <meta name="twitter:description" content="here, a device: the Ätmanoptican as a formulation of truth.">
    <meta name="twitter:image" content="https://aformulationoftruth.com/images/dreamMore...always.JPG">

    <!-- Favicons -->
    <link rel="icon" type="image/png" sizes="32x32" href="/favicons/favicon-simple-32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicons/favicon-simple-16.png">

    <!-- Styles -->
    <link rel="stylesheet" href="/css/index_style.css">

    <!-- Hierarchical Navigation -->
    <style>
        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           NAVIGATION HUB â€” word-level dropdowns
           Lives inside gate section, after irendu
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .site-hub-section {
            position: sticky;
            top: 0;
            z-index: 10;
            padding: 3rem 2rem;
            border-top: 1px solid var(--ghost);
            border-bottom: 1px solid var(--ghost);
            background: var(--void);
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.4s ease;
        }
        .site-hub-section.visible {
            opacity: 1;
            pointer-events: auto;
        }
        .site-hub {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.75rem;
        }
        .site-hub__row {
            display: flex;
            justify-content: center;
            align-items: baseline;
            gap: 2.5rem;
            flex-wrap: wrap;
        }
        /* Each dropdown trigger */
        .site-hub__item {
            position: relative;
        }
        .site-hub__label {
            font-family: 'Space Mono', monospace;
            font-size: 0.75rem;
            font-weight: 700;
            letter-spacing: 0.15em;
            text-transform: uppercase;
            background: none;
            border: none;
            padding: 0.4rem 0;
            cursor: pointer;
            position: relative;
            transition: color 0.25s ease, text-shadow 0.25s ease;
        }
        /* Accent colours per word */
        .site-hub__item--questionnaire .site-hub__label { color: var(--gold); }
        .site-hub__item--messenger .site-hub__label     { color: var(--neon-emerald); }
        .site-hub__item--storefront .site-hub__label    { color: var(--neon-orange); }
        .site-hub__item--library .site-hub__label       { color: var(--neon-purple); }
        .site-hub__item--about .site-hub__label            { color: var(--light); }
        .site-hub__item--contact .site-hub__label        { color: var(--neon-pink); }
        /* Direct-link label (no dropdown) */
        .site-hub__label--link {
            text-decoration: none;
            display: inline-block;
        }
        /* Underline that grows on hover */
        .site-hub__label::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            width: 0;
            height: 1px;
            transform: translateX(-50%);
            transition: width 0.25s ease, box-shadow 0.25s ease;
        }
        .site-hub__item--questionnaire .site-hub__label::after { background: var(--gold); }
        .site-hub__item--messenger .site-hub__label::after     { background: var(--neon-emerald); }
        .site-hub__item--storefront .site-hub__label::after    { background: var(--neon-orange); }
        .site-hub__item--library .site-hub__label::after       { background: var(--neon-purple); }
        .site-hub__item--about .site-hub__label::after          { background: var(--light); }
        .site-hub__item--contact .site-hub__label::after        { background: var(--neon-pink); }
        .site-hub__item:hover .site-hub__label::after,
        .site-hub__item:focus-within .site-hub__label::after {
            width: 100%;
        }
        .site-hub__item--questionnaire:hover .site-hub__label { text-shadow: 0 0 12px rgba(255,215,0,0.5); }
        .site-hub__item--messenger:hover .site-hub__label     { text-shadow: 0 0 12px var(--emerald-glow); }
        .site-hub__item--storefront:hover .site-hub__label    { text-shadow: 0 0 12px var(--orange-glow); }
        .site-hub__item--library:hover .site-hub__label       { text-shadow: 0 0 12px var(--purple-glow); }
        .site-hub__item--about:hover .site-hub__label          { text-shadow: 0 0 12px rgba(255,255,255,0.4); }
        .site-hub__item--contact:hover .site-hub__label        { text-shadow: 0 0 12px var(--pink-glow); }
        /* Dropdown panel */
        .site-hub__dropdown {
            position: absolute;
            top: calc(100% + 0.6rem);
            left: 50%;
            transform: translateX(-50%) translateY(4px);
            min-width: 160px;
            padding: 0.75rem 1rem;
            background: var(--obsidian);
            border: 1px solid var(--ghost);
            border-radius: 3px;
            box-shadow: 0 8px 24px rgba(0,0,0,0.6);
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.2s ease, transform 0.2s ease, visibility 0.2s ease;
            pointer-events: none;
            list-style: none;
            margin: 0;
            text-align: left;
        }
        .site-hub__item:hover .site-hub__dropdown,
        .site-hub__item:focus-within .site-hub__dropdown {
            opacity: 1;
            visibility: visible;
            transform: translateX(-50%) translateY(0);
            pointer-events: auto;
        }
        .site-hub__dropdown li {
            margin-bottom: 0.4rem;
        }
        .site-hub__dropdown li:last-child {
            margin-bottom: 0;
        }
        .site-hub__dropdown a {
            font-family: 'Space Mono', monospace;
            font-size: 0.7rem;
            color: var(--pearl);
            text-decoration: none;
            letter-spacing: 0.04em;
            white-space: nowrap;
            transition: color 0.15s ease;
            display: block;
            padding: 0.15rem 0;
        }
        .site-hub__dropdown a:hover {
            color: var(--light);
        }
        .site-hub__dropdown .coming-soon {
            font-family: 'Space Mono', monospace;
            font-size: 0.7rem;
            color: var(--mist);
            opacity: 0.45;
            white-space: nowrap;
            display: block;
            padding: 0.15rem 0;
        }
        .site-hub__dropdown .coming-soon::after {
            content: ' \b7 soon';
            font-size: 0.55rem;
            letter-spacing: 0.08em;
        }
        @media (max-width: 480px) {
            .site-hub__row { gap: 1.5rem; }
            .site-hub__label { font-size: 0.7rem; }
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           CSS-DRAWN GATE â€” scroll-reveal temple gate
           5 bars, 3 with pointed spire finials
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .gate-drawing {
            --gate-gold: #c9a84c;
            --gate-brown: #8b6914;
            --gate-shimmer: linear-gradient(
                135deg,
                var(--gate-brown) 0%,
                var(--gate-gold) 35%,
                #e8d48b 50%,
                var(--gate-gold) 65%,
                var(--gate-brown) 100%
            );
            position: relative;
            width: 220px;
            height: 160px;
            margin: 1.5rem auto 2rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            opacity: 0;
            transition: opacity 0.8s ease;
        }
        .gate-drawing.visible {
            opacity: 1;
        }
        /* Horizontal rails */
        .gate-drawing__rail {
            width: 100%;
            height: 3px;
            background: var(--gate-shimmer);
            background-size: 200% 100%;
            animation: gateShimmer 4s ease-in-out infinite;
            border-radius: 1px;
            transform: scaleX(0);
            transition: transform 0.6s ease 0.3s;
        }
        .gate-drawing.visible .gate-drawing__rail {
            transform: scaleX(1);
        }
        .gate-drawing__rail--top { transform-origin: left; }
        .gate-drawing__rail--bottom { transform-origin: right; }
        /* Bars container */
        .gate-drawing__bars {
            flex: 1;
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
            width: 100%;
            padding: 0 6px;
        }
        /* Individual bars */
        .gate-drawing__bar {
            width: 4px;
            height: 0;
            background: var(--gate-shimmer);
            background-size: 200% 100%;
            animation: gateShimmer 4s ease-in-out infinite;
            border-radius: 1px;
            position: relative;
            transition: height 0.8s ease;
        }
        .gate-drawing.visible .gate-drawing__bar {
            height: 100%;
        }
        /* Staggered reveal */
        .gate-drawing.visible .gate-drawing__bar:nth-child(1) { transition-delay: 0.5s; }
        .gate-drawing.visible .gate-drawing__bar:nth-child(2) { transition-delay: 0.65s; }
        .gate-drawing.visible .gate-drawing__bar:nth-child(3) { transition-delay: 0.8s; }
        .gate-drawing.visible .gate-drawing__bar:nth-child(4) { transition-delay: 0.65s; }
        .gate-drawing.visible .gate-drawing__bar:nth-child(5) { transition-delay: 0.5s; }
        /* Pointed spire finial on inner bars */
        .gate-drawing__bar--spired::before {
            content: '';
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%) translateY(-100%) scaleY(0);
            width: 0;
            height: 0;
            border-left: 7px solid transparent;
            border-right: 7px solid transparent;
            border-bottom: 18px solid var(--gate-gold);
            filter: drop-shadow(0 0 4px rgba(201, 168, 76, 0.4));
            transform-origin: bottom;
            transition: transform 0.5s ease;
        }
        .gate-drawing.visible .gate-drawing__bar--spired::before {
            transform: translateX(-50%) translateY(-100%) scaleY(1);
            transition-delay: 1.2s;
        }
        /* Center spire taller */
        .gate-drawing__bar--center::before {
            border-left-width: 8px;
            border-right-width: 8px;
            border-bottom-width: 24px;
        }
        @keyframes gateShimmer {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 200% 50%; }
        }
        @media (max-width: 480px) {
            .gate-drawing { width: 160px; height: 120px; }
        }
    </style>
</head>
<body>
    <a href="#begin" class="skip-link">Skip to questionnaire</a>
    <nav>
       <!-- <a href="/" class="logo">A4T</a> -->
    </nav>

    <main>
        <section class="hero">
            <!-- Indic numeral column - descending from 5 to 2 -->
            <div class="indic-column" aria-hidden="true">
                <span class="indic-num kannada-5">à³«</span>
                <span class="indic-num devanagari-4">à¥ª</span>
                <span class="indic-num sharada-3">ğ‘‡“</span>
                <img src="/images/irendu2.png" alt="" class="indic-num irendu-2">
            </div>

            <!-- Multicoloured neon watermark -->
            <div class="neon-watermark" aria-hidden="true">
                <span class="wm-left">a</span>
                <span class="wm-four">4</span>
                <span class="wm-right">à®®à¯à®²satyasya</span>
            </div>

            <div class="hero-content">
                <h1 class="title">
                    <!-- Background watermark: 4 à®®à¯‚à®² à¤¸à¤¤à¥ transitioning greenâ†’pink -->
                    <span class="bg-watermark" aria-hidden="true">
                        <span class="bg-four">4</span>
                        <span class="bg-mula">à®®à¯‚à®²</span>
                        <span class="bg-sat">à¤¸à¤¤à¥</span>
                    </span>
                    <span class="title-wrapper">
                        <span class="title-text">a formulation of truth</span>
                        <span class="title-flicker" aria-hidden="true">a formulation of truth</span>
                    </span>
                </h1>

                <!-- Full-width Buddha glitch video -->
                <div class="fullwidth-video-container">
                    <video class="fullwidth-video" autoplay muted loop playsinline>
                        <source src="/videos/buddha_glitch.MOV" type="video/quicktime">
                        <source src="/videos/buddha_glitch.MOV" type="video/mp4">
                    </video>
                    <div class="video-scanlines"></div>
                    <div class="fullwidth-scroll">
                        <p class="translation">Destroy afflictions and cause to blossom the lotus in the heart; may awareness, your innate radiance with body fit for purpose, feast upon consciousness cool as moonbeams.* And may your recognition transform this world into a place of eternal remembrance and awakening.</p>
                        <p class="attribution">â€” Utpaladeva (c. 900â€“950 CE)</p>
                    </div>
                    <!-- Footnote hover on cakora reference -->
                    <div class="trident-hover" style="position: absolute; bottom: 10%; left: 3%;">
                        <span class="trident-trigger" title="About the cakora">âœ¦</span>
                        <div class="trident-popup">
                            * The original Sanskrit refers to the <a href="https://en.wikipedia.org/wiki/Chakora_(mythology)" target="_blank" rel="noopener">cakora</a> (à¤šà¤•à¥‹à¤°), a mythical bird in Sanskrit poetry said to fly only at night and subsist entirely on moonbeams. I have omitted the cakora here as the metaphor has lost broader cultural resonance, but wish the reader to know this is an intentional departure from the original. The cakora's longing gaze toward the moon became a beloved trope for yearning after and devotion to the divine. In the 10th century CE, poets like Utpaladeva very likely conceptualized the divine in ways far healthier than we who find ourselves imbricated within the cultural and political contexts of modernityâ€”its corrupt power struggles, its flattened metaphysics, its instrumentalized faith that have defined our age.
                        </div>
                    </div>
                </div>
               <!-- <div class="cta-group">
                    <a href="#begin" class="cta cta-primary">à®¤à¯Šà®Ÿà®™à¯à®•à¯<br><span style="font-variant: small-caps; font-size: 0.7em; letter-spacing: 0.1em;">begin</span></a>
                </div>-->
            </div>
            <div class="scroll-indicator">
                <span></span>
            </div>
        </section>

        <!-- Navigation strip â€” its own home between hero and gate -->
        <section class="site-hub-section">
            <nav class="site-hub" aria-label="Site navigation">
                <div class="site-hub__row">
                    <div class="site-hub__item site-hub__item--questionnaire">
                        <button class="site-hub__label" aria-expanded="false">Questionnaire</button>
                        <ul class="site-hub__dropdown">
                            <li><a href="/questions.html">All Questions</a></li>
                            <li><a href="/proust/">Karuppacami Kelvittaal</a></li>
                        </ul>
                    </div>
                    <div class="site-hub__item site-hub__item--messenger">
                        <button class="site-hub__label" aria-expanded="false">Messenger</button>
                        <ul class="site-hub__dropdown">
                            <li><span class="coming-soon">Encrypted Messages</span></li>
                        </ul>
                    </div>
                    <div class="site-hub__item site-hub__item--storefront">
                        <button class="site-hub__label" aria-expanded="false">Storefront</button>
                        <ul class="site-hub__dropdown">
                            <li><span class="coming-soon">Tip Jar</span></li>
                            <!-- <li><span class="coming-soon">Crypto Donations</span></li> -->
                            <li><span class="coming-soon">Lottery</span></li>
                        </ul>
                    </div>
                </div>
                <div class="site-hub__row">
                    <div class="site-hub__item site-hub__item--library">
                        <button class="site-hub__label" aria-expanded="false">Library</button>
                        <ul class="site-hub__dropdown">
                            <li><span class="coming-soon">Books &amp; Inspirations</span></li>
                        </ul>
                    </div>
                    <div class="site-hub__item site-hub__item--about">
                        <a href="/about.html" class="site-hub__label site-hub__label--link">About</a>
                    </div>
                    <div class="site-hub__item site-hub__item--contact">
                        <a href="/contact.html" class="site-hub__label site-hub__label--link">Contact</a>
                    </div>
                </div>
            </nav>
        </section>

        <section id="begin" class="section gate-section">
            <div class="gate-content">
                <img src="/images/irendu2.png" alt="irendu â€” Tamil for 'two'" class="gate-icon" title="irendu â€” Tamil for 'two'">
                <!-- Gate Title: Tamil + English -->
                <h2 class="gate-title gate-title--tamil">à®µà®¾à®¯à®¿à®²à¯</h2>
                <h2 class="gate-title gate-title--english">here we meet</h2>

                <!-- CSS-drawn gate â€” reveals on scroll -->
                <div class="gate-drawing" aria-hidden="true">
                    <div class="gate-drawing__rail gate-drawing__rail--top"></div>
                    <div class="gate-drawing__bars">
                        <div class="gate-drawing__bar"></div>
                        <div class="gate-drawing__bar gate-drawing__bar--spired"></div>
                        <div class="gate-drawing__bar gate-drawing__bar--spired gate-drawing__bar--center"></div>
                        <div class="gate-drawing__bar gate-drawing__bar--spired"></div>
                        <div class="gate-drawing__bar"></div>
                    </div>
                    <div class="gate-drawing__rail gate-drawing__rail--bottom"></div>
                </div>

                <!-- Welcome Text: Tamil -->
                <p class="gate-description gate-welcome--tamil tamil-text">
                    Proust à®•à¯‡à®³à¯à®µà®¿à®¤à¯à®¤à®¾à®³à¯â€”à®•à®°à¯à®ªà¯à®ªà®šà®¾à®®à®¿ à®•à¯‡à®³à¯à®µà®¿à®¤à¯à®¤à®¾à®³à¯ à®à®©à¯à®± à®ªà¯†à®¯à®°à®¿à®²à¯â€”à®‰à®™à¯à®•à®³à¯ˆ à®µà®°à®µà¯‡à®±à¯à®•à®¿à®±à®¤à¯
                </p>
                <!-- Welcome Text: Transliteration -->
                <p class="gate-description gate-welcome--translit" style="font-size: 0.7rem; color: var(--mist); font-style: italic; margin-top: -1rem;">
                    Proust kÄ“á¸·vittÄá¸·â€”KaruppacÄmi kÄ“á¸·vittÄá¸· eá¹‰á¹Ÿa peyarilâ€”uá¹…kaá¸·ai varavÄ“á¹Ÿkiá¹Ÿatu
                </p>
                <!-- Welcome Text: English -->
                <p class="gate-description gate-welcome--english">
                    The Proust Questionnaireâ€”under the name Karuppasami Questionnaireâ€”welcomes you
                </p>
                <!-- Welcome Text: Spanish -->
                <p class="gate-description gate-welcome--spanish">
                    El Cuestionario de Proustâ€”bajo el nombre Cuestionario Karuppasamiâ€”te da la bienvenida
                </p>

                <!-- Language Display Selector -->
                <div class="a4m-lang-selector" role="group" aria-label="Question display language">
                    <span class="a4m-lang-selector__label">à®®à¯Šà®´à®¿</span>
                    <div class="a4m-lang-selector__options">
                        <button type="button" class="a4m-lang-selector__btn" data-lang="all" aria-pressed="true" title="tamil + Transliteration + English">
                            <span class="a4m-lang-selector__icon">à®¤</span>
                            <span class="a4m-lang-selector__text">+Tr</span>
                        </button>
                        <button type="button" class="a4m-lang-selector__btn" data-lang="tamil-only" aria-pressed="false" title="tamil only">
                            <span class="a4m-lang-selector__icon">à®¤</span>
                        </button>
                        <button type="button" class="a4m-lang-selector__btn" data-lang="tamil-translit" aria-pressed="false" title="tamil + Transliteration">
                            <span class="a4m-lang-selector__icon">à®¤</span>
                            <span class="a4m-lang-selector__text">+Aa</span>
                        </button>
                        <button type="button" class="a4m-lang-selector__btn" data-lang="english-only" aria-pressed="false" title="English only">
                            <span class="a4m-lang-selector__icon">En</span>
                        </button>
                        <button type="button" class="a4m-lang-selector__btn" data-lang="spanish-only" aria-pressed="false" title="Spanish only">
                            <span class="a4m-lang-selector__icon">Es</span>
                        </button>
                    </div>
                </div>

                <form class="gate-form" id="gate-form">
                    <!-- Gate Question 1: Perfect Happiness -->
                    <div class="form-group">
                        <label for="answer1" class="trilingual-label">
                            <span class="question-number">à¯§</span>
                            <span class="question-layers">
                                <!-- Primary: Tamil script -->
                                <span class="question-tamil" lang="ta">
                                    à®®à¯à®´à¯à®®à¯ˆà®¯à®¾à®© à®®à®•à®¿à®´à¯à®šà¯à®šà®¿ à®à®©à¯à®±à®¾à®²à¯ à®‰à®©à®•à¯à®•à¯ à®à®©à¯à®©?
                                </span>
                                <!-- Secondary: Transliteration -->
                                <span class="question-transliteration" lang="ta-Latn">
                                    Muá¸»umaiyÄá¹‰a makiá¸»cci eá¹‰á¹ŸÄl uá¹‰akku eá¹‰á¹‰a?
                                </span>
                                <!-- Tertiary: English -->
                                <span class="question-english">
                                    What is your idea of perfect happiness?
                                </span>
                                <!-- Quaternary: Spanish -->
                                <span class="question-spanish" lang="es">
                                    Â¿CuÃ¡l es tu idea de la felicidad perfecta?
                                </span>
                            </span>
                        </label>
                        <textarea
                            id="answer1"
                            name="answer1"
                            placeholder="Take your time..."
                            aria-describedby="accessibility-hint"
                        ></textarea>
                    </div>

                    <!-- Gate Question 2: Greatest Fear -->
                    <div class="form-group">
                        <label for="answer2" class="trilingual-label">
                            <span class="question-number">à¯¨</span>
                            <span class="question-layers">
                                <!-- Primary: Tamil script -->
                                <span class="question-tamil" lang="ta">
                                    à®‰à®©à¯à®©à¯à®Ÿà¯ˆà®¯ à®®à®¿à®•à®ªà¯à®ªà¯†à®°à®¿à®¯ à®…à®šà¯à®šà®®à¯ à®¯à®¾à®¤à¯?
                                </span>
                                <!-- Secondary: Transliteration -->
                                <span class="question-transliteration" lang="ta-Latn">
                                    Uá¹‰á¹‰uá¹­aiya mikapperiya accam yÄtu?
                                </span>
                                <!-- Tertiary: English -->
                                <span class="question-english">
                                    What is your greatest fear?
                                </span>
                                <!-- Quaternary: Spanish -->
                                <span class="question-spanish" lang="es">
                                    Â¿CuÃ¡l es tu mayor temor?
                                </span>
                            </span>
                        </label>
                        <textarea
                            id="answer2"
                            name="answer2"
                            placeholder="Or leave unanswered..."
                        ></textarea>
                    </div>

                    <div class="form-group email-section">
                        <label for="email">
                            <span class="question-english">Enter your email to receive a magic link</span>
                            <span class="question-spanish" lang="es">Introduce tu correo electrÃ³nico para recibir un enlace mÃ¡gico</span>
                        </label>
                        <input
                            type="email"
                            id="email"
                            name="email"
                            placeholder="your@email.com"
                            required
                            autocomplete="email"
                        >
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="submit-btn" id="submit-btn">
                            Continue to Questionnaire
                        </button>
                    </div>

                    <div class="status-message" id="status-message"></div>

                    <p class="accessibility-note" id="accessibility-hint">
                        For voice input, use <a href="https://github.com/cjpais/Handy" target="_blank" rel="noopener">Handy</a> â€” free offline speech-to-text
                    </p>

                    <p class="encryption-note">
                        Responses encrypted with age (X25519) before storage
                    </p>
                </form>
            </div>
        </section>
    </main>

    <footer>
        <div class="footer-inner">
            <div class="footer-links">
                <a href="/about.html">About</a>
                <a href="/contact.html">Contact</a>
                <a href="/privacy.html">Privacy</a>
            </div>
            <p class="footer-copy">
                Hosted with zero logs in Finland &middot; Encrypted database in Iceland
            </p>
        </div>
    </footer>

    <script>
        // Gate drawing â€” reveal on scroll
        const gateDrawing = document.querySelector('.gate-drawing');
        if (gateDrawing) {
            const gateObserver = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        gateDrawing.classList.add('visible');
                    }
                });
            }, { threshold: 0.3 });
            gateObserver.observe(gateDrawing);
        }

        // Navigation hub â€” aria-expanded toggle for keyboard accessibility
        document.querySelectorAll('.site-hub__label').forEach(btn => {
            btn.addEventListener('mouseenter', () => btn.setAttribute('aria-expanded', 'true'));
            btn.closest('.site-hub__item').addEventListener('mouseleave', () => btn.setAttribute('aria-expanded', 'false'));
            btn.addEventListener('click', () => {
                const expanded = btn.getAttribute('aria-expanded') === 'true';
                btn.setAttribute('aria-expanded', String(!expanded));
            });
        });

        // Navigation hub â€” show/hide based on scroll position
        // Appears just above the scroll-indicator, disappears at the gate
        (function initNavVisibility() {
            const hub = document.querySelector('.site-hub-section');
            const scrollIndicator = document.querySelector('.scroll-indicator');
            const gateSection = document.querySelector('.gate-section');
            if (!hub || !scrollIndicator || !gateSection) return;

            let pastIndicator = false;
            let pastGate = false;

            function updateVisibility() {
                hub.classList.toggle('visible', pastIndicator && !pastGate);
            }

            // Show when the scroll indicator leaves the viewport (scrolled past it)
            new IntersectionObserver(([entry]) => {
                pastIndicator = !entry.isIntersecting && entry.boundingClientRect.top < 0;
                updateVisibility();
            }, { threshold: 0 }).observe(scrollIndicator);

            // Hide when the gate section enters the viewport
            new IntersectionObserver(([entry]) => {
                pastGate = entry.isIntersecting;
                updateVisibility();
            }, { threshold: 0.05 }).observe(gateSection);
        })();

        // Smooth scroll for anchor links
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function(e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
            });
        });

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // A4M Language Selector â€” à®®à¯Šà®´à®¿ (Moá¸»i)
        // Persists preference to localStorage
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        (function initLangSelector() {
            const STORAGE_KEY = 'a4m-lang-mode';
            const gateContent = document.querySelector('.gate-content');
            const buttons = document.querySelectorAll('.a4m-lang-selector__btn');

            if (!gateContent || !buttons.length) return;

            // Restore saved preference
            const savedMode = localStorage.getItem(STORAGE_KEY) || 'all';
            setLangMode(savedMode);

            // Handle button clicks
            buttons.forEach(btn => {
                btn.addEventListener('click', function() {
                    const mode = this.dataset.lang;
                    setLangMode(mode);
                    localStorage.setItem(STORAGE_KEY, mode);
                });
            });

            function setLangMode(mode) {
                // Update data attribute on gate-content (CSS uses this for visibility)
                gateContent.dataset.langMode = mode;

                // Update aria-pressed states
                buttons.forEach(btn => {
                    btn.setAttribute('aria-pressed', btn.dataset.lang === mode);
                });
            }
        })();

        // Form handling
        const form = document.getElementById('gate-form');
        const submitBtn = document.getElementById('submit-btn');
        const statusMessage = document.getElementById('status-message');

        function showStatus(message, type) {
            statusMessage.textContent = message;
            statusMessage.className = `status-message visible ${type}`;
        }

        function hideStatus() {
            statusMessage.className = 'status-message';
        }

        function setButtonState(state, text) {
            submitBtn.textContent = text;
            submitBtn.className = `submit-btn ${state}`;
            submitBtn.disabled = state === 'loading';
        }

        form.addEventListener('submit', async function(e) {
            e.preventDefault();
            hideStatus();

            const email = document.getElementById('email').value.trim();
            const answer1 = document.getElementById('answer1').value.trim();
            const answer2 = document.getElementById('answer2').value.trim();

            // Validate email
            if (!email) {
                showStatus('Please enter your email address', 'error');
                return;
            }

            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email)) {
                showStatus('Please enter a valid email address', 'error');
                return;
            }

            // Build gate answers array
            const gateAnswers = [];
            if (answer1) {
                gateAnswers.push({
                    question: 'What is your idea of perfect happiness?',
                    answer: answer1
                });
            }
            if (answer2) {
                gateAnswers.push({
                    question: 'What is your greatest fear?',
                    answer: answer2
                });
            }

            // Update UI - encrypting
            setButtonState('loading', 'Encrypting...');
            showStatus('Securing your responses...', 'info');

            // Update UI - sending
            setButtonState('loading', 'Sending magic link...');
            showStatus('Requesting magic link...', 'info');

            try {
                const response = await fetch('/api/gate-submit', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ email, answer1, answer2 })
                });

                // Safely parse JSON - handle empty responses
                let data = {};
                const text = await response.text();
                if (text) {
                    try {
                        data = JSON.parse(text);
                    } catch (parseError) {
                        console.error('Failed to parse response:', text);
                    }
                }

                if (response.ok) {
                    setButtonState('success', 'Magic link sent!');
                    showStatus('Check your inbox for your magic link to continue the questionnaire.', 'success');

                    // Clear form but keep answers in sessionStorage
                    form.reset();

                    // Reset button after delay
                    setTimeout(() => {
                        setButtonState('', 'Continue to Questionnaire');
                    }, 5000);
                } else {
                    // Clear stored answers on error
                    sessionStorage.removeItem('pendingGateAnswers');
                    throw new Error(data.error || 'Failed to send magic link');
                }
            } catch (error) {
                console.error('Submission error:', error);
                sessionStorage.removeItem('pendingGateAnswers');
                setButtonState('', 'Continue to Questionnaire');
                showStatus(error.message || 'Something went wrong. Please try again.', 'error');
            }
        });

        // Intersection Observer for scroll animations
        const observerOptions = {
            threshold: 0.1,
            rootMargin: '0px 0px -50px 0px'
        };

        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.style.opacity = '1';
                    entry.target.style.transform = 'translateY(0)';
                }
            });
        }, observerOptions);

        // Observe sections for fade-in
        document.querySelectorAll('.section-inner, .gate-content').forEach(el => {
            el.style.opacity = '0';
            el.style.transform = 'translateY(30px)';
            el.style.transition = 'opacity 0.8s ease, transform 0.8s ease';
            observer.observe(el);
        });

        // DISABLED: Play poem audio on first mouse movement (bypasses autoplay restrictions)
        // Plays once, pauses 10s, plays once more, then stops
        /*
        const poemAudio = document.getElementById('poem-audio');
        let audioStarted = false;
        let playCount = 0;

        function startAudioOnInteraction() {
            if (audioStarted || !poemAudio) return;
            audioStarted = true;

            // When audio ends, handle the pause-and-replay logic
            poemAudio.addEventListener('ended', function handleEnded() {
                playCount++;
                if (playCount === 1) {
                    // First play finished - wait 10 seconds, then play again
                    setTimeout(() => {
                        poemAudio.currentTime = 0;
                        poemAudio.play().catch(err => {
                            console.log('Second play failed:', err);
                        });
                    }, 10000);
                } else {
                    // Second play finished - done, remove listener
                    poemAudio.removeEventListener('ended', handleEnded);
                    console.log('Poem recitation complete');
                }
            });

            poemAudio.play().then(() => {
                console.log('Poem recitation started');
            }).catch(err => {
                console.log('Audio play failed:', err);
                audioStarted = false; // Allow retry on next interaction
            });

            // Remove listeners after successful start
            if (audioStarted) {
                document.removeEventListener('mousemove', startAudioOnInteraction);
                document.removeEventListener('touchstart', startAudioOnInteraction);
            }
        }

        document.addEventListener('mousemove', startAudioOnInteraction, { once: false });
        document.addEventListener('touchstart', startAudioOnInteraction, { once: false });
        */
    </script>
</body>
</html>
