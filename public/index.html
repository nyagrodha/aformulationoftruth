<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>a formulation of truth</title><!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;600;700;800&family=Noto+Sans+Tamil:wght@400;700&family=Noto+Sans+Devanagari:wght@400;700&display=swap" rel="stylesheet"><!-- Stylesheets -->
  <link rel="stylesheet" href="/css/themes.css">
  <style>
  </style>
  <meta name="description" content="a Proust questionnaire dba Karupacami kelvittal">

  <!-- Open Graph Meta Tags -->
  <meta property="og:title" content="a formulation of truth">
  <meta property="og:description" content="A practice in self-inquiry. These questions invite upon users reflective states of awareness, revealing something interior that vivifies oneself as a formulation of truth.">
  <meta property="og:image" content="https://aformulationoftruth.com/callbackground.png">
  <meta property="og:url" content="https://aformulationoftruth.com">
  <meta property="og:type" content="website">
  <meta property="og:site_name" content="a formulation of truth">

  <!-- Twitter Card Meta Tags -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="a formulation of truth">
  <meta name="twitter:description" content="A practice in self-inquiry. These questions invite upon users reflective states of awareness, revealing something interior that vivifies oneself as a formulation of truth.">
  <meta name="twitter:image" content="https://aformulationoftruth.com/callbackground.png">
</head>
<body>
  <!-- Hero Section -->
  <section class="hero">
   <div style="font-family: 'Noto Sans Tamil', sans-serif; font-size: clamp(2rem, 5vw, 3rem); font-weight: 700; text-align: center; margin-bottom: 0.5rem; color: var(--accent-1); text-shadow: 0 0 10px var(--glow-1);">‡Ø®</div>
    <h1 class="hero-title">you are this moment</h1>

    <!-- Large @ Symbol -->
    <div style="font-family: 'Orbitron', monospace; font-size: clamp(8rem, 15vw, 12rem); font-weight: 700; text-align: center; margin: 2rem auto; color: var(--accent-1); text-shadow: 0 0 20px var(--glow-1), 0 0 40px var(--glow-1); line-height: 1; opacity: 0.9;">@</div>

    <!-- Lockup -->
    <div class="lockup">
      <div class="lockup-tamil">
        ‡Æâ‡Æ£‡Øç‡ÆÆ‡Øà‡ÆØ‡Øà ‡Æö‡ØÇ‡Æ§‡Øç‡Æ§‡Æø‡Æ∞‡ÆÆ‡Øç
      </div>
      <div class="lockup-center">
        || a formulation of truth ||
      </div>
      <div class="lockup-ukr">
        —Ñ–æ—Ä–º—É–ª—é–≤–∞–Ω–Ω—è —ñ—Å—Ç–∏–Ω–∏
      </div>
    </div><!-- Description -->
    <p style="max-width: 800px; margin: 2rem auto; padding: 0 1rem;">A practice in <a href="https://www.davidgodman.org/the-practice-of-self-enquiry/" target="_blank">self-inquiry</a> these questions invite upon users reflective states of awareness. Persons' crafted responses (or a non-response!) reveal something interior (<a href="https://en.wikipedia.org/wiki/Puram" target="_blank">‡ÆÖ‡Æï‡ÆÆ‡Øç</a>)--the idiosyncratic machinations that vivify oneself, as such, a person and a formulation of truth.</p><!-- Navigation Cards -->
    <div class="grid">
      <div class="card">
        <h3>Begin</h3>
        <p style="margin-bottom: 1rem;">Sign in to begin the questionnaire</p>

        <form id="auth-form" style="margin-top: 1rem;">
          <button type="button" id="oauth-login-btn" style="width: 100%; padding: 0.75rem; background: var(--accent-1); color: var(--bg-color); border: none; border-radius: 4px; font-family: 'Orbitron', monospace; font-weight: 600; cursor: pointer; transition: all 0.4s ease; margin-bottom: 0.75rem;">
            üîê Sign in with Keycloak
          </button>

          <div style="text-align: center; margin: 0.75rem 0; color: var(--text-color); opacity: 0.6; font-size: 0.9rem;">
            ‚Äî or use magic link ‚Äî
          </div>

          <input
            type="email"
            id="email-input"
            placeholder="your.email@example.com"
            style="width: 100%; padding: 0.75rem; border: 1px solid var(--accent-1); background: var(--bg-color); color: var(--text-color); border-radius: 4px; margin-bottom: 0.75rem; font-family: 'Orbitron', monospace;"
          >
          <button type="submit" style="width: 100%; padding: 0.75rem; background: transparent; color: var(--accent-1); border: 2px solid var(--accent-1); border-radius: 4px; font-family: 'Orbitron', monospace; font-weight: 600; cursor: pointer; transition: all 0.4s ease;">
            Send Magic Link
          </button>
        </form>

        <div id="auth-message" style="margin-top: 1rem; padding: 0.75rem; border-radius: 4px; display: none;"></div>
      </div>

      <a class="card" href="/about.html">
        <h3>about the site</h3>
        <p>We are able to find everything in our memory, which is like a dispensary or chemical laboratory in which chance steers our hand sometimes to a soothing drug and sometimes to a dangerous poison.</p>
      </a>

      <a class="card" href="/contact.html">
        <h3>contact</h3>
        <p>Reach out to share feedback, ask questions, or discuss collaboration opportunities.</p>
      </a>
    </div><!-- Footer Quote -->
    <p style="margin-top: 2rem; font-style: italic; opacity: 0.9; max-width: 700px; padding: 0 1rem;">It has been said that beauty brings a promise of happiness, but it could be otherwise that the possibility of joy is the beginning of beauty. So have fun and, if you wish, share what you create so joy may ever await you.</p>
  </section>
  <a href="https://billing.flokinet.is/aff.php?aff=543"><img src=https://flokinet.is/images/floki_logo.svg width="542" height="161" border="0"></a>
 <script>
  // Handle both OAuth and magic link authentication
  (function() {
    const authForm = document.getElementById('auth-form');
    const emailInput = document.getElementById('email-input');
    const oauthBtn = document.getElementById('oauth-login-btn');
    const authMessage = document.getElementById('auth-message');

    // OAuth login handler
    oauthBtn.addEventListener('click', function(e) {
      e.preventDefault();

      oauthBtn.disabled = true;
      oauthBtn.textContent = 'üîê Redirecting to Keycloak...';

      // Redirect to OAuth login endpoint
      window.location.href = '/api/auth/oidc/login';
    });

    // Magic link handler
    authForm.addEventListener('submit', async function(e) {
      e.preventDefault();

      const email = emailInput.value.trim();
      if (!email) {
        showMessage('Please enter your email', 'error');
        return;
      }

      // Disable form while processing
      emailInput.disabled = true;
      authForm.querySelector('button[type="submit"]').disabled = true;
      showMessage('Sending magic link...', 'info');

      try {
        const response = await fetch('/api/auth/request-magic-link', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ email })
        });

        const data = await response.json();

        if (response.ok) {
          showMessage('‚úÖ Check your email! Click the magic link to begin.', 'success');
          emailInput.value = '';
        } else {
          showMessage(data.error || 'Failed to send magic link.', 'error');
        }
      } catch (error) {
        console.error('Error:', error);
        showMessage('Network error. Please try again.', 'error');
      } finally {
        emailInput.disabled = false;
        authForm.querySelector('button[type="submit"]').disabled = false;
      }
    });

    // Check if user is already logged in
    checkAuthStatus();

    async function checkAuthStatus() {
      try {
        const response = await fetch('/api/user/me', {
          credentials: 'include'
        });

        if (response.ok) {
          const user = await response.json();
          showMessage(`‚úÖ Welcome back, ${user.displayName || user.email}!`, 'success');
        }
      } catch (error) {
        // Not logged in, no action needed
      }
    }

    function showMessage(text, type) {
      authMessage.textContent = text;
      authMessage.style.display = 'block';
      authMessage.style.background = type === 'error' ? 'rgba(239, 68, 68, 0.2)' :
                                      type === 'success' ? 'rgba(34, 197, 94, 0.2)' :
                                      'rgba(59, 130, 246, 0.2)';
      authMessage.style.border = type === 'error' ? '1px solid #ef4444' :
                                  type === 'success' ? '1px solid #22c55e' :
                                  '1px solid #3b82f6';
      authMessage.style.color = 'var(--text-color)';

      // Auto-hide error/info messages after 5 seconds, but keep success visible
      if (type !== 'success') {
        setTimeout(() => {
          authMessage.style.display = 'none';
        }, 5000);
      }
    }
  })();
 </script>
</body>
</html>
